<div [ngClass]="['w-full', className]">
  <div *ngIf="!open" class="flex items-center gap-1">
    <span class="text-[14px] font-medium leading-5 text-[hsl(var(--muted-foreground))]">{{ hintLabel }}</span>
    <button
      type="button"
      class="inline-flex h-5 items-center gap-0.5 rounded-[6px] border border-[hsl(var(--border))] bg-[hsl(var(--muted))] px-1.5"
      (click)="toggleOpen()"
    >
      <pdm-icon name="command" [size]="12" className="text-[hsl(var(--muted-foreground))]" [decorative]="true"></pdm-icon>
      <span class="text-[12px] leading-4 text-[hsl(var(--muted-foreground))]">{{ hintKey }}</span>
    </button>
  </div>

  <section
    *ngIf="open"
    class="flex w-full flex-col overflow-hidden rounded-[10px] border border-[hsl(var(--border))] bg-[hsl(var(--background))] shadow-md"
  >
    <div class="flex items-center gap-2 border-b border-[hsl(var(--border))] px-3">
      <pdm-icon name="search" [size]="16" className="text-[hsl(var(--muted-foreground))]" [decorative]="true"></pdm-icon>
      <input
        type="text"
        [placeholder]="placeholder"
        [value]="query"
        (input)="onQueryChange($event)"
        class="h-10 w-full bg-transparent py-3 text-[14px] leading-5 text-[hsl(var(--foreground))] outline-none placeholder:text-[hsl(var(--muted-foreground))]"
      />
    </div>

    <div class="max-h-[300px] overflow-y-auto p-1">
      <ng-container *ngFor="let group of groupedItems; let groupIndex = index">
        <div *ngIf="group.name" class="px-2 py-[6px] text-[12px] leading-4 text-[hsl(var(--muted-foreground))]">{{ group.name }}</div>
        <button
          *ngFor="let item of group.items"
          type="button"
          [disabled]="item.disabled"
          class="flex w-full items-center gap-2 rounded-[6px] px-2 py-[6px] text-left"
          [ngClass]="[
            item.disabled ? 'opacity-50' : '',
            item.label === 'Calendar' ? 'bg-[hsl(var(--muted))]' : ''
          ]"
          (click)="select(item.value)"
        >
          <span class="inline-flex h-4 w-4 items-center justify-center text-[hsl(var(--foreground))]">
            <pdm-icon *ngIf="item.icon" [name]="item.icon" [size]="16" [decorative]="true"></pdm-icon>
          </span>
          <span class="min-w-0 flex-1 text-[14px] leading-5 text-[hsl(var(--foreground))]">{{ item.label }}</span>
          <span *ngIf="item.shortcut" class="text-[12px] leading-4 text-[hsl(var(--muted-foreground))]">{{ item.shortcut }}</span>
        </button>
        <div *ngIf="groupIndex === 0 && groupedItems.length > 1" class="my-1 border-t border-[hsl(var(--border))]"></div>
      </ng-container>

      <p *ngIf="filteredItems.length === 0" class="py-6 text-center text-[14px] text-[hsl(var(--muted-foreground))]">{{ emptyMessage }}</p>
    </div>
  </section>
</div>
