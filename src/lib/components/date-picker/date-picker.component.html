<section [ngClass]="['flex w-full flex-col gap-3', variant === 'range' ? 'max-w-xl' : 'max-w-sm', className]">
  <label class="text-sm font-medium text-foreground">{{ label }}</label>

  <div class="relative">
    <div class="flex items-center gap-2" *ngIf="variant === 'date-time'; else defaultTrigger">
      <button
        type="button"
        class="inline-flex h-9 flex-1 items-center justify-between rounded-md border border-input bg-background px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50"
        (click)="toggle()"
      >
        <span class="truncate text-sm text-foreground">{{ value }}</span>
        <svg viewBox="0 0 16 16" class="h-4 w-4 text-muted-foreground" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
      <div class="inline-flex h-9 w-24 items-center rounded-md border border-input bg-background px-3 text-xs text-foreground shadow-sm">
        {{ time }}
      </div>
    </div>

    <ng-template #defaultTrigger>
      <button
        *ngIf="variant !== 'range'; else rangeTrigger"
        type="button"
        class="inline-flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50"
        (click)="toggle()"
      >
        <span class="truncate text-sm" [ngClass]="[displayValue === 'Select a date' ? 'text-muted-foreground' : 'text-foreground']">
          {{ displayValue }}
        </span>
        <svg viewBox="0 0 16 16" class="h-4 w-4 text-muted-foreground" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </button>
    </ng-template>

    <ng-template #rangeTrigger>
      <button
        type="button"
        class="inline-flex h-[62px] w-full items-center gap-4 rounded-2xl border border-input bg-background px-5 text-left shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring/50"
        (click)="toggle()"
      >
        <svg viewBox="0 0 24 24" class="h-8 w-8 shrink-0 text-foreground" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          <rect x="3" y="4" width="18" height="17" rx="2" stroke="currentColor" stroke-width="2" />
          <path d="M3 9H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        <span class="truncate text-[18px] leading-7 text-foreground sm:text-2xl sm:leading-9">
          {{ displayValue }}
        </span>
      </button>
    </ng-template>

    <p *ngIf="variant === 'natural-language'" class="mt-2 text-xs text-muted-foreground">
      {{ naturalLanguageHint }}
    </p>

    <div *ngIf="open" class="absolute left-0 top-full z-30 mt-2 w-auto">
      <div class="rounded-lg border border-border bg-background p-0 shadow-md">
        <pdm-calendar
          [month]="month"
          [year]="year"
          [selectedDay]="selectedDay"
          [mode]="variant === 'range' ? 'range' : 'single'"
          (monthChange)="month = $event"
          (yearChange)="year = $event"
          (selectedDayChange)="selectedDay = $event"
          (dateSelect)="onCalendarDateSelect($event)"
        ></pdm-calendar>

        <div *ngIf="variant === 'with-input' || variant === 'natural-language'" class="flex gap-2 border-t border-border p-3">
          <button type="button" class="inline-flex h-8 items-center rounded-md border border-input px-3 text-xs text-foreground hover:bg-accent" (click)="selectPreset('Today')">
            Today
          </button>
          <button type="button" class="inline-flex h-8 items-center rounded-md border border-input px-3 text-xs text-foreground hover:bg-accent" (click)="selectPreset('Tomorrow')">
            Tomorrow
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
