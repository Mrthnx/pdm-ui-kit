<div [ngClass]="['relative', className || 'w-full']">
  <button
    #triggerEl
    type="button"
    [id]="id"
    [disabled]="disabled"
    [attr.aria-invalid]="invalid"
    [attr.aria-expanded]="open"
    [attr.data-state]="open ? 'open' : 'closed'"
    aria-haspopup="listbox"
    (click)="toggle()"
    [ngClass]="[
      'border-input focus-visible:border-ring focus-visible:ring-2 focus-visible:ring-ring/50 aria-invalid:ring-2 aria-invalid:ring-destructive aria-invalid:border-destructive flex h-9 w-full appearance-none items-center justify-between rounded-md border bg-background px-3 py-2 text-sm shadow-sm outline-none disabled:cursor-not-allowed disabled:opacity-50',
    ]"
  >
    <span
      [ngClass]="[
        'min-w-0 flex-1 truncate text-left leading-5',
        selectedOption
          ? 'font-medium text-foreground'
          : 'font-normal text-muted-foreground',
      ]"
    >
      {{ selectedLabel }}
    </span>
    <pdm-icon
      name="chevron-down"
      [size]="16"
      className="shrink-0 text-muted-foreground"
    ></pdm-icon>
  </button>

  <div
    *ngIf="open"
    #panelEl
    role="listbox"
    [attr.aria-labelledby]="id || null"
    [ngClass]="panelClasses"
    [style.max-height.px]="panelMaxHeightPx"
  >
    <button
      *ngFor="let option of options"
      type="button"
      role="option"
      [attr.aria-selected]="option.value === value"
      [disabled]="option.disabled"
      (click)="selectOption(option)"
      [ngClass]="[
        'flex w-full appearance-none items-center justify-between rounded-sm border-0 bg-transparent px-2 py-1.5 text-left text-sm outline-none transition-colors',
        option.disabled
          ? 'cursor-not-allowed opacity-50'
          : 'hover:bg-accent hover:text-accent-foreground focus-visible:bg-accent focus-visible:text-accent-foreground',
        option.value === value ? 'text-foreground' : '',
      ]"
    >
      <span class="min-w-0 flex-1 truncate leading-5">{{ option.label }}</span>
      <span
        *ngIf="option.value === value"
        class="ml-2 flex shrink-0 items-center justify-end"
      >
        <pdm-icon
          name="check"
          [size]="16"
          className="shrink-0 text-current"
        ></pdm-icon>
      </span>
    </button>
  </div>

  <select
    class="sr-only"
    tabindex="-1"
    aria-hidden="true"
    [value]="value"
    (change)="onChange($event)"
  >
    <option
      *ngFor="let option of options"
      [value]="option.value"
      [disabled]="option.disabled"
    >
      {{ option.label }}
    </option>
  </select>
</div>
